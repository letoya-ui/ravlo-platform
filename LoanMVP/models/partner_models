# LoanMVP/models/partner_models.py (or wherever Partner model lives)

from datetime import datetime
from LoanMVP.extensions import db

class PartnerRequest(db.Model):
    __tablename__ = "partner_requests"

    id = db.Column(db.Integer, primary_key=True)

    borrower_user_id = db.Column(db.Integer, db.ForeignKey("user.id"), nullable=False)
    partner_id = db.Column(db.Integer, db.ForeignKey("partners.id"), nullable=False)

    # Optional context (keep nullable so it works now)
    borrower_profile_id = db.Column(db.Integer, db.ForeignKey("borrower_profile.id"), nullable=True)
    lead_id = db.Column(db.Integer, db.ForeignKey("lead.id"), nullable=True)
    property_id = db.Column(db.Integer, db.ForeignKey("property.id"), nullable=True)

    category = db.Column(db.String(100), nullable=True)   # matches Partner.category filter
    message = db.Column(db.Text, nullable=True)

    status = db.Column(db.String(20), default="pending")  # pending/accepted/declined/canceled/completed
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    responded_at = db.Column(db.DateTime, nullable=True)

    partner = db.relationship("Partner", backref=db.backref("requests", lazy=True))


class PartnerConnectionRequest(db.Model):
    __tablename__ = "partner_connection_requests"

    id = db.Column(db.Integer, primary_key=True)

    borrower_user_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=False)
    partner_id = db.Column(db.Integer, db.ForeignKey("partners.id"), nullable=False)

    category = db.Column(db.String(50), nullable=True)  # optional (cleaning, contractor, etc.)
    message = db.Column(db.Text, nullable=True)

    status = db.Column(db.String(20), default="pending")  # pending | accepted | declined | canceled
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    responded_at = db.Column(db.DateTime, nullable=True)

    # Helpful relationship (optional)
    partner = db.relationship("Partner", backref=db.backref("connection_requests", lazy=True))

class PartnerJob(db.Model):
    __tablename__ = "partner_jobs"

    id = db.Column(db.Integer, primary_key=True)
    partner_id = db.Column(db.Integer, db.ForeignKey("partners.id"), nullable=False)
    borrower_profile_id = db.Column(db.Integer, db.ForeignKey("borrower_profile.id"), nullable=True)
    property_id = db.Column(db.Integer, db.ForeignKey("property.id"), nullable=True)

    title = db.Column(db.String(200), nullable=False)
    scope = db.Column(db.Text, nullable=True)

    status = db.Column(db.String(30), default="Open")  # Open/In Progress/Blocked/Complete
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

    partner = db.relationship("Partner", backref=db.backref("jobs", lazy=True))
    borrower = db.relationship("BorrowerProfile", backref=db.backref("partner_jobs", lazy=True))
