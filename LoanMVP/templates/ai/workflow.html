{% extends "layouts/base.html" %}
{% block title %}AI Workflow Builder{% endblock %}
{% block content %}


<main style="margin-left:260px; padding:2rem; background:#0f0f11; color:#e6e6e6; min-height:100vh;">
  <link rel="stylesheet" href="https://unpkg.com/lucide-static@latest/font/lucide.css">

  <style>
    .grid{display:grid;gap:1.25rem;}
    .g-2{grid-template-columns:repeat(2,minmax(0,1fr));}
    .card{background:#15161a;border:1px solid #282b31;border-radius:14px;padding:1.5rem;box-shadow:0 0 18px rgba(122,184,255,0.25);}
    .card h3{margin:0 0 .8rem;color:#7ab8ff;display:flex;align-items:center;gap:.5rem;}
    input, textarea{
      width:100%;background:#0f0f11;color:#e6e6e6;border:1px solid #2b2f36;
      border-radius:10px;padding:.7rem .9rem;font-size:.95rem;
    }
    input:focus,textarea:focus{outline:none;border-color:#7ab8ff;box-shadow:0 0 6px rgba(122,184,255,0.3);}
    textarea{min-height:120px;resize:vertical;}
    .btn{display:inline-flex;align-items:center;gap:.4rem;margin-top:1rem;background:linear-gradient(180deg,#2a4a62,#1b2a38);border:1px solid #2a4a62;color:#cfe8ff;border-radius:10px;padding:.7rem 1.2rem;text-decoration:none;cursor:pointer;}
    .btn:hover{box-shadow:0 0 10px rgba(122,184,255,0.3);}
    pre{background:#0f0f11;border:1px solid #2b2f36;border-radius:10px;padding:1rem;color:#a9f0ff;overflow:auto;font-family:monospace;font-size:.9rem;white-space:pre-wrap;word-break:break-word;}
    .muted{color:#a5a7ad;font-size:.9rem;}
  </style>

  <h1 style="margin-bottom:1rem;">üß© AI Workflow Builder</h1>
  <p class="muted" style="margin-bottom:2rem;">Use AI to auto-generate step-by-step workflows for loan processing, borrower onboarding, or property evaluations.</p>

  <div class="grid g-2">
    <!-- Workflow Input -->
    <div class="card">
      <h3><i class="lucide lucide-cpu"></i> Define Workflow Task</h3>
      <form id="workflowForm" method="POST">
        <label for="task">Task Name</label>
        <input type="text" id="task" name="task" placeholder="e.g., Loan Application Review" required>

        <label for="description" style="margin-top:1rem;">Task Description</label>
        <textarea id="description" name="description" placeholder="Describe the steps or goals the AI should outline..." required></textarea>

        <button type="submit" class="btn"><i class="lucide lucide-brain-circuit"></i> Generate Workflow</button>
      </form>
    </div>

    <!-- Workflow Output -->
    <div class="card">
      <h3><i class="lucide lucide-file-text"></i> AI Generated Workflow</h3>
      <pre id="workflowOutput">No workflow generated yet. Fill in details and click "Generate".</pre>
    </div>
  </div>

  <script>
    const form=document.getElementById('workflowForm');
    const output=document.getElementById('workflowOutput');

    form.addEventListener('submit',async(e)=>{
      e.preventDefault();
      const formData=new FormData(form);
      output.textContent="üß† Processing your request...";
      try{
        const res=await fetch("{{ url_for('ai.workflow') }}",{
          method:"POST",
          body:new URLSearchParams({
            task:formData.get('task'),
            description:formData.get('description')
          })
        });
        const data=await res.json();
        output.textContent=data.workflow || "‚ö†Ô∏è No response generated.";
      }catch(err){
        output.textContent="‚ùå Error: Unable to connect to AI server.";
      }
    });
  </script>
</main>
{% endblock %}
