{% extends "layouts/base.html" %}
{% block title %}Conditions â€¢ Borrower Portal{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/lucide-static@latest/font/lucide.css">

<style>
:root {
    --bg:#0f0f11;
    --panel:#15161a;
    --line:#2b2f36;
    --text:#e6e6e6;
    --muted:#a5a7ad;
    --accent:#7ab8ff;
    --danger:#ff6767;
}

body { background:var(--bg); color:var(--text); }

.card {
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:16px;
    padding:1.5rem;
    margin-bottom:2rem;
    box-shadow:0 0 18px rgba(122,184,255,0.25);
}

.condition {
    border-left:4px solid var(--accent);
    padding-left:1rem;
    margin-bottom:1.5rem;
}

.upload-area {
    margin-top:.8rem;
    background:#1a1c20;
    padding:1rem;
    border-radius:12px;
    border:1px solid var(--line);
}

.btn {
    padding:.7rem 1.2rem;
    border:1px solid var(--accent);
    border-radius:10px;
    background:transparent;
    color:var(--accent);
    cursor:pointer;
}
.btn:hover { background:var(--accent); color:#000; }

.btn-ai {
    border:1px solid #00d1ff;
    color:#00d1ff;
}
.btn-ai:hover {
    background:#00d1ff;
    color:#000;
}

textarea {
    width:100%;
    background:#1b1d21;
    border:1px solid var(--line);
    color:var(--text);
    border-radius:12px;
    padding:1rem;
    margin-top:.7rem;
}
</style>

<main class="dashboard-main">

    <h1>ðŸ“‹ Underwriting Conditions</h1>
    <p class="muted">Upload documents and manage your conditions.</p>

    {% if not conditions %}
        <div class="card">
            <p>No conditions have been issued yet.</p>
        </div>
    {% endif %}

    {% for c in conditions %}
    <div class="card condition">

        <h3>{{ c.condition_type }}</h3>
        <p class="muted">{{ c.description }}</p>

        <p><strong>Status:</strong>
            {% if c.status == "Open" %}
                <span style="color:var(--danger);">Open</span>
            {% elif c.status == "Submitted" %}
                <span style="color:var(--accent);">Submitted</span>
            {% elif c.status == "Cleared" %}
                <span style="color:#4CAF50;">Cleared</span>
            {% endif %}
        </p>

        <div class="upload-area">
            <form action="/portal/conditions/upload/{{ c.id }}" method="POST" enctype="multipart/form-data">
                <input type="file" name="file" required>
                <button class="btn" type="submit">Upload for Condition</button>
            </form>
        </div>

        <button class="btn-ai" onclick="explainCondition({{ c.id }})">
            ðŸ¤– Explain This Condition
        </button>

        <textarea id="ai-{{ c.id }}" placeholder="AI explanation will appear hereâ€¦" readonly></textarea>

    </div>
    {% endfor %}

</main>

<script>
function explainCondition(id) {
    fetch(`/portal/conditions/ai/${id}`)
    .then(r => r.json())
    .then(data => {
        document.getElementById(`ai-${id}`).value = data.reply;
    });
}
</script>

{% endblock %}
