{% extends "layouts/base.html" %}
{% block title %}AI Tip ‚Ä¢ Borrower Assistant{% endblock %}
{% block content %}

<main class="dashboard-main">
  <aside>{% include "layouts/_sidebar_borrower.html" %}</aside>

  <div class="content" style="margin-left:260px;padding:2rem;color:var(--text-light);">
    <div class="card" style="background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:1.5rem;box-shadow:0 0 18px rgba(122,184,255,0.25);max-width:900px;margin:auto;">
      <h2 class="text-accent mb-3"><i class="lucide lucide-sparkles"></i> Smart AI Tips</h2>
      <p class="text-muted mb-4">Ask the AI assistant for advice, insights, or quick financial explanations.</p>

      <!-- Input Form -->
      <form id="tipForm" method="POST" action="{{ url_for('borrower_ai.ai_tip') }}" onsubmit="return askTip(event)">
        <div style="display:flex;gap:.5rem;">
          <input type="text" id="tipQuery" name="query" placeholder="e.g. How can I improve my DSCR score?" required
            style="flex:1;background:var(--bg);border:1px solid var(--line);border-radius:8px;padding:.75rem;color:var(--text-light);">
          <button type="submit" class="btn btn-accent">Ask</button>
        </div>
      </form>

      <!-- Response Section -->
      <div id="tipResult" class="mt-4" style="background:var(--hover);padding:1rem;border-radius:10px;border:1px solid var(--line);display:none;">
        <h5 style="color:var(--accent);margin-bottom:.5rem;">ü§ñ AI Assistant Says:</h5>
        <p id="tipText" style="white-space:pre-wrap;color:var(--text-light);"></p>
      </div>

      <!-- Example Quick Tips -->
      <hr style="border-color:var(--line);margin:2rem 0;">
      <h4 style="color:var(--accent);margin-bottom:.5rem;">üí° Quick Prompts</h4>
      <div style="display:flex;flex-wrap:wrap;gap:.5rem;">
        <button type="button" class="chip" onclick="setTip('How can I increase my loan approval chances?')">üìà Approval Tips</button>
        <button type="button" class="chip" onclick="setTip('Explain LTV and how it affects my rate.')">üè¶ LTV Basics</button>
        <button type="button" class="chip" onclick="setTip('Should I refinance if rates drop 1%?')">üí∞ Refinance Advice</button>
        <button type="button" class="chip" onclick="setTip('What‚Äôs a good DSCR for rental loans?')">üèò DSCR Guide</button>
      </div>
    </div>
  </div>
</main>

<style>
  :root {
    --bg:#0f0f11;
    --panel:#15161a;
    --line:#282b31;
    --text-light:#e6e6e6;
    --text-muted:#a5a7ad;
    --accent:#7ab8ff;
    --hover:#1f2328;
    --border:#2b2f36;
  }

  .chip {
    background:var(--hover);
    border:1px solid var(--line);
    border-radius:10px;
    padding:.5rem .9rem;
    color:var(--text-light);
    font-size:.9rem;
    cursor:pointer;
    transition:all .2s ease;
  }
  .chip:hover {
    background:var(--accent);
    color:#000;
    box-shadow:0 0 10px rgba(122,184,255,0.3);
  }

  .btn-accent {
    background:var(--accent);
    color:#000;
    border:none;
    border-radius:8px;
    padding:.6rem 1.2rem;
    cursor:pointer;
    font-weight:600;
  }
  .btn-accent:hover {
    opacity:0.9;
    box-shadow:0 0 10px rgba(122,184,255,0.4);
  }
</style>

<script>
async function askTip(event) {
  event.preventDefault();
  const query = document.getElementById('tipQuery').value.trim();
  if (!query) return;

  const res = await fetch(`/borrower_ai/ai_tip?query=${encodeURIComponent(query)}`);
  const data = await res.json();

  document.getElementById('tipResult').style.display = 'block';
  document.getElementById('tipText').textContent = data.reply || 'No response received.';
}

function setTip(prompt) {
  document.getElementById('tipQuery').value = prompt;
  document.getElementById('tipQuery').focus();
}
</script>

{% endblock %}
