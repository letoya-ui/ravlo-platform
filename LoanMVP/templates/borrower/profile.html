{% extends "layouts/borrower_base.html" %}
{% block title %}My Profile{% endblock %}
{% block content %}

<div class="borrower-shell">

  <!-- SIDEBAR -->
  <aside class="b-sidebar">
    <div class="b-sidebar-logo">CM</div>

    <div class="b-sidebar-group">

      <a href="{{ url_for('borrower.dashboard') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <rect x="3" y="3" width="8" height="8" rx="2"></rect>
          <rect x="13" y="3" width="8" height="5" rx="2"></rect>
          <rect x="13" y="10" width="8" height="11" rx="2"></rect>
          <rect x="3" y="13" width="8" height="8" rx="2"></rect>
        </svg>
        <div class="b-tooltip">Dashboard</div>
      </a>

      <a href="{{ url_for('borrower.property_search') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 3L4 9v11h16V9l-8-6Z"></path>
          <circle cx="12" cy="13" r="2.5"></circle>
        </svg>
        <div class="b-tooltip">Property Finder</div>
      </a>

      <a href="{{ url_for('borrower.resource_center') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <circle cx="8" cy="8" r="3"></circle>
          <circle cx="16" cy="8" r="3"></circle>
          <path d="M4 19c.6-2.4 2.3-4 4-4s3.4 1.6 4 4"></path>
          <path d="M12 19c.6-2.4 2.3-4 4-4s3.4 1.6 4 4"></path>
        </svg>
        <div class="b-tooltip">Partner Network</div>
      </a>

      <a href="{{ url_for('borrower.deal_workspace') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <rect x="4" y="4" width="16" height="16" rx="2"></rect>
          <path d="M8 9h8M8 13h5M8 17h3"></path>
        </svg>
        <div class="b-tooltip">Project Planner</div>
      </a>

      <a href="{{ url_for('borrower.saved_properties') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 20s-4.5-2.7-6.7-5.4C3.4 13 3 11.9 3 10.8 3 8.7 4.7 7 6.8 7c1.2 0 2.3.6 3 1.5.7-.9 1.8-1.5 3-1.5C15.3 7 17 8.7 17 10.8c0 1.1-.4 2.2-2.3 3.8C16.5 17.3 12 20 12 20Z"></path>
        </svg>
        <div class="b-tooltip">Saved Properties</div>
      </a>

      <a href="{{ url_for('borrower.resource_center') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M5 4h10a3 3 0 0 1 3 3v13l-4-2-4 2-4-2-4 2V7a3 3 0 0 1 3-3Z"></path>
        </svg>
        <div class="b-tooltip">Resource Center</div>
      </a>

    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="b-main">

    <!-- TOP TABS -->
    <div class="b-top-tabs">
      <a href="{{ url_for('borrower.dashboard') }}" class="b-top-tab">Dashboard</a>
      <a href="{{ url_for('borrower.status') }}" class="b-top-tab">Loan</a>
      <a href="{{ url_for('borrower.documents') }}" class="b-top-tab">Documents</a>
      <a href="{{ url_for('borrower.messages') }}" class="b-top-tab">Messages</a>
      <div class="b-top-tab active">My Profile</div>
    </div>

    <!-- PROFILE CARD -->
    <div class="b-card" style="max-width:900px;margin:0 auto;padding:2rem;">

      <h1 class="page-title">üë§ My Profile</h1>
      <p class="muted">View and update your borrower information.</p>

      <div class="profile-header" style="display:flex;align-items:center;margin-top:1rem;">
        <div class="avatar" style="width:90px;height:90px;border-radius:50%;overflow:hidden;background:var(--hover);display:flex;align-items:center;justify-content:center;font-size:2rem;color:var(--accent);margin-right:1.5rem;">
          {% if current_user.profile_pic %}
            <img src="{{ current_user.profile_pic }}" alt="Profile Picture" style="width:100%;height:100%;object-fit:cover;">
          {% else %}
            <div class="placeholder">{{ current_user.username[0]|upper }}</div>
          {% endif %}
        </div>

        <div>
          <h2 style="margin:0;">{{ current_user.name or 'Unnamed Borrower' }}</h2>
          <p class="muted" style="margin:.25rem 0;">{{ current_user.email }}</p>
          <span class="badge" style="background:var(--accent);color:#000;padding:.3rem .6rem;border-radius:6px;">
            {{ current_user.subscription_plan }} Plan
          </span>
        </div>
      </div>

      <form method="POST" enctype="multipart/form-data" action="{{ url_for('borrower.update_profile') }}" style="margin-top:2rem;">
        <div class="form-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;">

          <div>
            <label class="muted">Full Name</label>
            <input type="text" name="full_username" value="{{ current_user.username or '' }}" class="form-control">
          </div>

          <div>
            <label class="muted">Email</label>
            <input type="email" name="email" value="{{ current_user.email or '' }}" class="form-control">
          </div>

          <div>
            <label class="muted">Phone</label>
            <input type="text" name="phone" value="{{ current_user.phone or '' }}" class="form-control">
          </div>

          <div>
            <label class="muted">Company</label>
            <input type="text" name="company" value="{{ current_user.company or '' }}" class="form-control">
          </div>

          <div>
            <label class="muted">Loan Type</label>
            <select name="loan_type" class="form-control">
              <option value="">-- Select Loan Type --</option>
              <option value="Residential" {% if current_user.loan_type == 'Residential' %}selected{% endif %}>Residential</option>
              <option value="Commercial" {% if current_user.loan_type == 'Commercial' %}selected{% endif %}>Commercial</option>
              <option value="Construction" {% if current_user.loan_type == 'Construction' %}selected{% endif %}>Construction</option>
            </select>
          </div>

          <div>
            <label class="muted">Profile Picture</label>
            <input type="file" name="profile_pic" accept="image/*" class="form-control">
          </div>

        </div>

        <button type="submit" class="btn-glow" style="margin-top:1.5rem;">üíæ Save Changes</button>
      </form>

    </div>

    <!-- SUBSCRIPTION CARD -->
    <div class="b-card" style="max-width:900px;margin:2rem auto;padding:2rem;">
      <h2>üí≥ Subscription</h2>
      <p class="muted">Manage your plan below.</p>

      <div style="margin:1rem 0;display:flex;align-items:center;gap:.5rem;">
        <strong>Current Plan:</strong>
        <span class="badge" style="background:var(--accent);color:#000;padding:.3rem .6rem;border-radius:6px;">
          {{ current_user.subscription_plan }}
        </span>
      </div>

      <div>
        {% if current_user.subscription_plan == 'Free' %}
          <form method="POST" action="{{ url_for('borrower.upgrade_plan') }}">
            <button type="submit" class="btn-glow">üöÄ Upgrade to Pro</button>
          </form>
        {% else %}
          <form method="POST" action="{{ url_for('borrower.downgrade_plan') }}">
            <button type="submit" class="action-btn">‚¨áÔ∏è Downgrade to Free</button>
          </form>
        {% endif %}
      </div>
    </div>

  </main>
</div>

{% endblock %}
