{% extends "layouts/borrower_base.html" %}
{% block title %}Borrower Activity{% endblock %}
{% block content %}

<div class="borrower-shell">

  <!-- SIDEBAR -->
  <aside class="b-sidebar">
    <div class="b-sidebar-logo">CM</div>

    <div class="b-sidebar-group">

      <a href="{{ url_for('borrower.dashboard') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <rect x="3" y="3" width="8" height="8" rx="2"></rect>
          <rect x="13" y="3" width="8" height="5" rx="2"></rect>
          <rect x="13" y="10" width="8" height="11" rx="2"></rect>
          <rect x="3" y="13" width="8" height="8" rx="2"></rect>
        </svg>
        <div class="b-tooltip">Dashboard</div>
      </a>

      <a href="{{ url_for('borrower.property_search') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 3L4 9v11h16V9l-8-6Z"></path>
          <circle cx="12" cy="13" r="2.5"></circle>
        </svg>
        <div class="b-tooltip">Property Finder</div>
      </a>

      <a href="{{ url_for('borrower.resource_center') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <circle cx="8" cy="8" r="3"></circle>
          <circle cx="16" cy="8" r="3"></circle>
          <path d="M4 19c.6-2.4 2.3-4 4-4s3.4 1.6 4 4"></path>
          <path d="M12 19c.6-2.4 2.3-4 4-4s3.4 1.6 4 4"></path>
        </svg>
        <div class="b-tooltip">Partner Network</div>
      </a>

      <a href="{{ url_for('borrower.deal_workspace') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <rect x="4" y="4" width="16" height="16" rx="2"></rect>
          <path d="M8 9h8M8 13h5M8 17h3"></path>
        </svg>
        <div class="b-tooltip">Project Planner</div>
      </a>

      <a href="{{ url_for('borrower.saved_properties') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 20s-4.5-2.7-6.7-5.4C3.4 13 3 11.9 3 10.8 3 8.7 4.7 7 6.8 7c1.2 0 2.3.6 3 1.5.7-.9 1.8-1.5 3-1.5C15.3 7 17 8.7 17 10.8c0 1.1-.4 2.2-2.3 3.8C16.5 17.3 12 20 12 20Z"></path>
        </svg>
        <div class="b-tooltip">Saved Properties</div>
      </a>

      <a href="{{ url_for('borrower.resource_center') }}" class="b-sidebar-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M5 4h10a3 3 0 0 1 3 3v13l-4-2-4 2-4-2-4 2V7a3 3 0 0 1 3-3Z"></path>
        </svg>
        <div class="b-tooltip">Resource Center</div>
      </a>

    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="b-main">

    <!-- TOP TABS -->
    <div class="b-top-tabs">
      <a href="{{ url_for('borrower.dashboard') }}" class="b-top-tab">Dashboard</a>
      <a href="{{ url_for('borrower.status') }}" class="b-top-tab">Loan</a>
      <a href="{{ url_for('borrower.documents') }}" class="b-top-tab">Documents</a>
      <a href="{{ url_for('borrower.document_requests') }}" class="b-top-tab">Conditions</a>
      <a href="{{ url_for('borrower.payments') }}" class="b-top-tab">Payments</a>
      <a href="{{ url_for('borrower.messages') }}" class="b-top-tab">Messages</a>
      <a href="{{ url_for('borrower.ai_hub') }}" class="b-top-tab">AI Hub</a>
      <div class="b-top-tab active">Activity</div>
    </div>

    <!-- ACTIVITY FEED -->
    <div class="activity-feed">

      <h2>ðŸ“‹ Borrower Activity â€” {{ borrower.full_name }}</h2>

      {% if loan_officer %}
      <div class="loan-officer">
        Assigned Loan Officer: <span>{{ loan_officer.name }}</span> ({{ loan_officer.email }})
      </div>
      {% endif %}

      <div class="ai-summary">
        <strong>ðŸ¤– AI Summary:</strong>
        <p>{{ ai_summary }}</p>
      </div>

      <!-- CALLS -->
      {% if calls %}
        {% for call in calls %}
        <div class="activity-item">
          <div><i class="lucide lucide-phone"></i> Call with {{ call.contact_name or "Unknown" }}</div>
          <div class="activity-meta">
            {{ call.created_at.strftime('%b %d, %Y %I:%M %p') }} â€” {{ call.outcome or 'Completed' }}
          </div>
          {% if call.notes %}
            <div class="muted">{{ call.notes }}</div>
          {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">No call activity found.</div>
      {% endif %}

      <!-- MESSAGES -->
      {% if messages %}
        {% for msg in messages %}
        <div class="activity-item">
          <div><i class="lucide lucide-message-square"></i> Message</div>
          <div class="activity-meta">{{ msg.created_at.strftime('%b %d, %Y %I:%M %p') }}</div>
          <div class="muted">{{ msg.content }}</div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">No messages found.</div>
      {% endif %}

      <!-- LOANS -->
      {% if loans %}
        {% for loan in loans %}
        <div class="activity-item">
          <div><i class="lucide lucide-file-text"></i> Loan Application</div>
          <div class="activity-meta">{{ loan.created_at.strftime('%b %d, %Y') }}</div>
          <div>Status: <span style="color:var(--accent)">{{ loan.status or "In Progress" }}</span></div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">No loan applications yet.</div>
      {% endif %}

    </div>

  </main>
</div>

{% endblock %}
