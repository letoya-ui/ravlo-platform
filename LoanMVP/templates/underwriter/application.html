{% extends "layouts/base.html" %}
{% block title %}Underwriter ‚Ä¢ Application Review{% endblock %}
{% block content %}
<main class="dashboard-main">

<style>
  :root {
    --bg:#0f0f11;--panel:#15161a;--line:#282b31;
    --text:#e6e6e6;--muted:#a5a7ad;--accent:#7ab8ff;
    --success:#43d19e;--warn:#ffdf6e;--danger:#ff6b6b;
    --glow:0 0 18px rgba(122,184,255,.35);
  }
  body{background:var(--bg);color:var(--text);}
  .card{background:var(--panel);border:1px solid var(--line);
        border-radius:14px;padding:1rem;box-shadow:var(--glow);margin-bottom:1rem;}
  h2,h3{color:var(--text);}
  .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem .9rem;
       border-radius:10px;border:1px solid var(--line);color:var(--text);
       background:#1b1c20;text-decoration:none;}
  .btn:hover{border-color:var(--accent);box-shadow:var(--glow);}
  .muted{color:var(--muted);}
  pre{background:#1a1a1a;border:1px solid var(--line);padding:1rem;
      border-radius:10px;white-space:pre-wrap;color:#d8e2f0;}
  table{width:100%;border-collapse:collapse;}
  th,td{padding:.6rem .5rem;border-top:1px solid var(--line);}
  th{color:#cfe0f5;text-align:left;}
</style>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>üìÑ Loan Application #{{ loan.id }}</h2>
    <a href="{{ url_for('underwriter.review_loans') }}" class="btn">‚Üê Back</a>
  </div>

  <div class="card">
    <h4>Borrower Information</h4>
    <p><strong>Name:</strong> {{ borrower.full_name }}</p>
    <p><strong>Email:</strong> {{ borrower.email }}</p>
    <p><strong>Property:</strong> {{ borrower.property_address or '‚Äî' }}</p>
  </div>

  <div class="card">
    <h4>Loan Details</h4>
    <p><strong>Type:</strong> {{ loan.loan_type }}</p>
    <p><strong>Amount:</strong> ${{ "{:,.2f}".format(loan.amount or 0) }}</p>
    <p><strong>Status:</strong> {{ loan.status }}</p>
    <p><strong>Created:</strong> {{ loan.created_at.strftime('%b %d, %Y') if loan.created_at else '‚Äî' }}</p>
  </div>

  <div class="card">
    <h4>Credit Profile</h4>
    {% if credit %}
      <p><strong>FICO:</strong> {{ credit.fico_score }}</p>
      <p><strong>Debt Ratio:</strong> {{ credit.debt_to_income }}%</p>
      <p><strong>Credit Summary:</strong> {{ credit.summary }}</p>
    {% else %}
      <p class="muted">No credit data available.</p>
    {% endif %}
  </div>

  <div class="card">
    <h4>Uploaded Documents</h4>
    {% if docs %}
      <table>
        <thead><tr><th>File</th><th>Status</th><th>Date</th></tr></thead>
        <tbody>
          {% for d in docs %}
          <tr>
            <td>{{ d.filename }}</td>
            <td>{{ d.status }}</td>
            <td>{{ d.uploaded_at.strftime('%b %d, %Y') if d.uploaded_at else '‚Äî' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No documents uploaded yet.</p>
    {% endif %}
  </div>

  <div class="card">
    <h4>AI Risk Summary</h4>
    <pre>{{ ai_summary or "AI analysis not available." }}</pre>
  </div>

  <div class="card">
    <h4>Underwriter Actions</h4>
    <form method="POST" action="{{ url_for('underwriter.update_application', loan_id=loan.id) }}">
      <div class="mb-3">
        <label>Decision</label>
        <select name="decision" required>
          <option value="approved">Approve</option>
          <option value="declined">Decline</option>
          <option value="needs_info">Request More Info</option>
        </select>
      </div>
      <div class="mb-3">
        <label>Notes</label>
        <textarea name="notes" rows="3" placeholder="Enter underwriting remarks..."></textarea>
      </div>
      <button class="btn btn-primary" type="submit">üíæ Save Decision</button>
    </form>
  </div>
</div>

{% endblock %}
