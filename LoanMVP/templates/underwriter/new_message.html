{% extends "layouts/base.html" %}
{% block title %}New Message{% endblock %}
{% block content %}

<div class="wrap">

    <section class="lhs">
        <div class="card">

            <div class="newmsg-header">
                <h2><i class="lucide lucide-user-plus"></i> Start New Message</h2>

                <a href="{{ url_for('underwriter.messages') }}" class="exit-btn">
                    <i class="lucide lucide-log-out"></i> Exit
                </a>
            </div>

            <p class="muted">Choose who you want to message.</p>

            <!-- SEARCH -->
            <input type="text" id="recipientSearch" class="search-input"
                   placeholder="Search recipientsâ€¦">

            <form method="POST" class="newmsg-form">

                <label class="form-label">Select Recipient</label>

                <select name="partner_id" required class="form-select" id="recipientSelect">
                    {% for user in users %}
                        <option value="{{ user.id }}">
                            {{ user.full_name }} ({{ user.role }})
                        </option>
                    {% endfor %}
                </select>

                <button type="submit" class="btn-glow full-btn">
                    <i class="lucide lucide-send"></i> Start Conversation
                </button>
            </form>

        </div>
    </section>

</div>

<style>
.newmsg-header {
    display:flex; justify-content:space-between; align-items:center;
}

.exit-btn {
    display:inline-flex; align-items:center; gap:.4rem;
    background:#111113; border:1px solid var(--line);
    padding:.45rem .9rem; border-radius:8px; color:var(--text);
    text-decoration:none; transition:.2s ease;
}
.exit-btn:hover { background:var(--accent); color:#000; box-shadow:var(--glow); }

.search-input {
    width:100%; padding:.7rem; margin:1rem 0;
    border-radius:10px; background:#0f0f11; border:1px solid var(--line);
    color:var(--text);
}

.newmsg-form { display:flex; flex-direction:column; gap:1rem; }

.form-select {
    width:100%; padding:.75rem; border-radius:10px;
    background:#0f0f11; border:1px solid var(--line); color:var(--text);
}
.full-btn { width:100%; padding:.75rem; border-radius:10px; }
</style>

<script>
document.getElementById("recipientSearch").addEventListener("input", function () {
    const filter = this.value.toLowerCase();
    const select = document.getElementById("recipientSelect");
    const options = select.options;

    for (let i = 0; i < options.length; i++) {
        const text = options[i].text.toLowerCase();
        options[i].style.display = text.includes(filter) ? "block" : "none";
    }
});
</script>

{% endblock %}
