{% extends "layouts/base.html" %}
{% block content %}
<style>
  :root{--line:#2a2e36; --panel:#15161a; --text:#e6e6e6; --muted:#a5a7ad}
  .card{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:1rem}
  table{width:100%; border-collapse:collapse}
  th,td{padding:.6rem; border-top:1px solid var(--line); color:var(--text)}
  input{background:#0f0f11; border:1px solid var(--line); color:var(--text); border-radius:10px; padding:.45rem .6rem; width:100%}
  .btn{display:inline-flex; align-items:center; gap:.5rem; padding:.6rem .9rem; border-radius:10px; border:1px solid var(--line); color:var(--text); text-decoration:none; background:#1a1d23}
</style>
<div class="layout-container" style="display:flex; min-height:100vh;">

  <main class="dashboard-content fade-in" style="flex-grow:1;">
    <h1 style="color:var(--highlight); margin-bottom:1.5rem;">ðŸ“Š Loan Pipeline</h1>

    <div class="card fade-in">
      <h3>Overview by Status</h3>

      {% if grouped %}
      {% for status, loans in grouped.items() %}
      <div style="margin-bottom:2rem;">
        <h4 style="color:var(--accent); text-transform:capitalize;">
          {{ status.replace('_', ' ') }} ({{ loans|length }})
        </h4>

        {% if loans %}
        <table class="table">
          <thead>
            <tr>
              <th>Borrower</th>
              <th>Loan Type</th>
              <th>Amount</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for loan in loans %}
            <tr>
              <td>{{ loan.borrower_name if loan.borrower_name else "N/A" }}</td>
              <td>{{ loan.loan_type }}</td>
              <td>${{ "{:,.2f}".format(loan.amount) }}</td>
              <td>{{ loan.created_at.strftime("%b %d, %Y") if loan.created_at else "â€”" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p style="color:var(--text-muted); margin-left:1rem;">No loans in this category.</p>
        {% endif %}
      </div>
      {% endfor %}
      {% else %}
        <p style="color:var(--text-muted);">No pipeline data available.</p>
      {% endif %}
    </div>
  </main>
</div>
{% endblock %}
