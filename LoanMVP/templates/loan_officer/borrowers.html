{% extends "layouts/base.html" %}
{% block title %}Borrowers ‚Ä¢ Loan Officer{% endblock %}

{% block content %}

<style>
/* ===========================
    BORROWER LIST STYLES
=========================== */

.search-bar {
    margin-bottom: 1.5rem;
    display:flex;
    gap:1rem;
}

.search-input {
    flex:1;
    padding:.75rem 1rem;
    background:#0f1115;
    color:white;
    border:1px solid var(--line);
    border-radius:12px;
    font-size:1rem;
}

.search-input:focus {
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 10px rgba(122,184,255,0.5);
}

.borrower-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
    gap:1.4rem;
}

.borrower-card {
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:16px;
    padding:1.4rem;
    box-shadow:0 0 14px rgba(122,184,255,0.25);
    animation:pulseGlow 1.5s infinite ease-in-out;
    transition:.25s ease;
}

.borrower-card:hover {
    transform:translateY(-2px);
    box-shadow:0 0 18px rgba(122,184,255,0.4);
}

/* Glow Animation */
@keyframes pulseGlow {
    0% { box-shadow:0 0 12px rgba(122,184,255,.20); }
    50% { box-shadow:0 0 22px rgba(122,184,255,.45); }
    100% { box-shadow:0 0 12px rgba(122,184,255,.20); }
}

.borrower-name {
    font-size:1.3rem;
    font-weight:700;
    color:white;
    text-shadow:0 0 10px rgba(122,184,255,0.4);
}

.borrower-info {
    font-size:.9rem;
    color:var(--muted);
    margin-top:.4rem;
    line-height:1.5;
}

.credit-tag {
    display:inline-block;
    background:#0f1115;
    padding:.3rem .6rem;
    border-radius:8px;
    font-size:.8rem;
    margin-top:.5rem;
    border:1px solid var(--line);
    color:white;
}

.btn-open {
    margin-top:1rem;
    padding:.6rem 1rem;
    font-weight:600;
    background:var(--accent);
    border:none;
    border-radius:10px;
    color:black;
    cursor:pointer;
    width:100%;
}

.btn-open:hover {
    background:white;
    color:black;
}
</style>


<!-- ===========================
      PAGE TITLE
=========================== -->
<h1 style="font-size:2rem; margin-bottom:1.2rem; text-shadow:0 0 16px rgba(122,184,255,0.45);">
    Borrowers
</h1>



<!-- ===========================
      SEARCH BAR
=========================== -->
<div class="search-bar">
    <input 
        type="text"
        id="searchBox"
        class="search-input"
        placeholder="Search borrowers by name, email, or phone..."
        onkeyup="filterBorrowers()"
    >
</div>



<!-- ===========================
      BORROWER GRID
=========================== -->
<div class="borrower-grid" id="borrowerGrid">

    {% for b in borrowers %}
    <div class="borrower-card" data-name="{{ b.full_name|lower }}">
        <div class="borrower-name">{{ b.full_name }}</div>

        <div class="borrower-info">
            üìß {{ b.email }}<br>
            üìû {{ b.phone }}<br>
            üè° {{ b.city }}, {{ b.state }}
        </div>

        {% set credit = b.credit_profiles[-1] if b.credit_profiles else None %}
        {% if credit %}
        <div class="credit-tag">Credit Score: {{ credit.score }}</div>
        {% else %}
        <div class="credit-tag" style="opacity:.6;">No Credit Pull Yet</div>
        {% endif %}

        <button class="btn-open" onclick="location.href='/loan_officer/borrower/{{ b.id }}'">
            Open Loan File
        </button>
    </div>
    <td>
      <span style="
          color: {{
            'lime' if b.credit_score is not none and b.credit_score > 70
            else 'gold' if b.credit_score is not none and b.credit_score > 40
            else 'tomato'
         }};
         font-weight:600;">
       {{ b.credit_score if b.credit_score is not none else 'N/A' }}
     </span>
   </td>
   {% endfor %}

</div>



<!-- ===========================
      SEARCH FILTER SCRIPT
=========================== -->
<script>
function filterBorrowers() {
    let input = document.getElementById("searchBox").value.toLowerCase();
    let cards = document.querySelectorAll("#borrowerGrid .borrower-card");

    cards.forEach(card => {
        let name = card.getAttribute("data-name");
        card.style.display = name.includes(input) ? "" : "none";
    });
}
</script>

{% endblock %}
