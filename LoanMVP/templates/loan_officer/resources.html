{% extends "layouts/base.html" %}
{% block title %}Resource Center{% endblock %}
{% block content %}

<div style="display:flex;">
 
  <main class="dashboard-main" style="margin-left:260px; width:calc(100% - 260px);">

    <h2>üìö Resource Center</h2>
    <p class="muted">Search or ask the AI for underwriting, compliance, or marketing resources.</p>

    <!-- ======== Quick Resource Links ======== -->
    <div class="grid g-2 mt-2">
      {% for item in resources %}
        <div class="card">
          <h4>{{ item.title }}</h4>
          <a href="{{ item.link }}" class="btn btn-glow mt-1">Open</a>
        </div>
      {% endfor %}
    </div>

    <!-- ======== AI Search Assistant ======== -->
    <div class="card mt-2">
      <h3>ü§ñ Ask the AI Assistant</h3>
      <form method="POST" id="aiForm">
        <textarea name="query" placeholder="e.g. What are DSCR loan requirements for mixed-use properties?" required></textarea>
        <button type="submit" class="btn btn-glow mt-1">Ask</button>
      </form>

      {% if ai_reply %}
        <div class="ai-hint mt-2">
          <h4>AI Response:</h4>
          <p>{{ ai_reply | safe }}</p>
        </div>
      {% elif query %}
        <div class="ai-hint mt-2">‚ö†Ô∏è No AI response available at this moment.</div>
      {% endif %}
    </div>

    <!-- Optional: Live chat version (AJAX-based) -->
    <div class="card mt-2" id="liveChatCard">
      <h3>üí¨ Live Resource Chat</h3>
      <div id="chatLog" style="max-height:300px; overflow-y:auto; padding:0.5rem; background:#111; border-radius:10px; border:1px solid var(--line);"></div>
      <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
        <input type="text" id="chatInput" placeholder="Type a question..." style="flex:1;">
        <button class="btn btn-glow" id="sendChat">Send</button>
      </div>
    </div>
  </main>
</div>

<script>
document.getElementById("sendChat").addEventListener("click", async () => {
  const input = document.getElementById("chatInput");
  const log = document.getElementById("chatLog");
  const query = input.value.trim();
  if (!query) return;

  log.innerHTML += `<p><strong>You:</strong> ${query}</p>`;
  input.value = "";

  const res = await fetch("{{ url_for('loan_officer.resources_chat') }}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query })
  });
  const data = await res.json();
  log.innerHTML += `<p><strong>AI:</strong> ${data.reply}</p>`;
  log.scrollTop = log.scrollHeight;
});
</script>

{% endblock %}
