{% extends "layouts/base.html" %}
{% block title %}New Message{% endblock %}
{% block content %}

<div class="wrap">

    <section class="lhs">
        <div class="card">

            <!-- HEADER WITH EXIT BUTTON -->
            <div class="newmsg-header">
                <h2><i class="lucide lucide-user-plus"></i> Start New Message</h2>

                <a href="{{ url_for('processor.messages') }}" class="exit-btn">
                    <i class="lucide lucide-log-out"></i> Exit
                </a>
            </div>

            <p class="muted">Choose who you want to message.</p>

            <!-- SEARCH BAR -->
            <input type="text" id="recipientSearch" class="search-input"
                   placeholder="Search recipients...">

            <form method="POST" class="newmsg-form">

                <label class="form-label">Select Recipient</label>

                <select name="partner_id" required class="form-select" id="recipientSelect">
                    {% for user in users %}
                        <option value="{{ user.id }}">
                            {{ user.full_name }} ({{ user.role }})
                        </option>
                    {% endfor %}
                </select>

                <button type="submit" class="btn-glow full-btn">
                    <i class="lucide lucide-send"></i> Start Conversation
                </button>
            </form>

        </div>
    </section>

</div>

<style>
/* Header */
.newmsg-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Exit Button */
.exit-btn {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
    background: #111113;
    border: 1px solid var(--line);
    padding: .45rem .9rem;
    border-radius: 8px;
    color: var(--text);
    font-size: .9rem;
    text-decoration: none;
    transition: .2s ease;
}

.exit-btn:hover {
    background: var(--accent);
    color: #000;
    box-shadow: var(--glow);
}

/* Search Input */
.search-input {
    width: 100%;
    padding: .7rem;
    margin: 1rem 0;
    border-radius: 10px;
    background: #0f0f11;
    border: 1px solid var(--line);
    color: var(--text);
    font-size: .95rem;
}

/* Form */
.newmsg-form {
    margin-top: .5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-label {
    font-size: .9rem;
    color: var(--muted);
}

.form-select {
    width: 100%;
    padding: 0.75rem;
    border-radius: 10px;
    background: #0f0f11;
    border: 1px solid var(--line);
    color: var(--text);
    font-size: .95rem;
    transition: .2s ease;
}

.form-select:hover {
    border-color: var(--accent);
}

.full-btn {
    width: 100%;
    padding: .75rem;
    font-size: .95rem;
    border-radius: 10px;
}
</style>

<script>
// ‚≠ê Live Search for Recipients
document.getElementById("recipientSearch").addEventListener("input", function () {
    const filter = this.value.toLowerCase();
    const select = document.getElementById("recipientSelect");
    const options = select.options;

    for (let i = 0; i < options.length; i++) {
        const text = options[i].text.toLowerCase();
        options[i].style.display = text.includes(filter) ? "block" : "none";
    }
});
</script>

{% endblock %}
